From 6fe96136a4ef6ee26cf6252b5d411022590af5b1 Mon Sep 17 00:00:00 2001
From: xiajinlin <jinlin.xia@amlogic.com>
Date: Fri, 17 May 2013 17:53:49 +0800
Subject: [PATCH] waitting kplayer finished

---
 media/mediaserver/Android.mk           |    3 ++-
 media/mediaserver/main_mediaserver.cpp |    9 +++++++++
 2 files changed, 11 insertions(+), 1 deletion(-)
 mode change 100644 => 100755 media/mediaserver/main_mediaserver.cpp

diff --git a/media/mediaserver/Android.mk b/media/mediaserver/Android.mk
index 5a73cdd..84102d4 100644
--- a/media/mediaserver/Android.mk
+++ b/media/mediaserver/Android.mk
@@ -9,7 +9,8 @@ LOCAL_SHARED_LIBRARIES := \
 	libcameraservice \
 	libmediaplayerservice \
 	libutils \
-	libbinder
+	libbinder \
+        libcutils
 
 # FIXME The duplicate audioflinger is temporary
 LOCAL_C_INCLUDES := \
diff --git a/media/mediaserver/main_mediaserver.cpp b/media/mediaserver/main_mediaserver.cpp
old mode 100644
new mode 100755
index ddd5b84..fe38a24
--- a/media/mediaserver/main_mediaserver.cpp
+++ b/media/mediaserver/main_mediaserver.cpp
@@ -28,11 +28,20 @@
 #include "CameraService.h"
 #include "MediaPlayerService.h"
 #include "AudioPolicyService.h"
+#include <cutils/properties.h>
 
 using namespace android;
 
 int main(int argc, char** argv)
 {
+    while(1){
+	    char value[PROPERTY_VALUE_MAX];
+	    property_get("init.svc.kplayer", value, "unknown");
+	    if(strcmp(value, "stopped") == 0)
+	            break;
+	    sleep(1);
+    }
+
     signal(SIGPIPE, SIG_IGN);
     sp<ProcessState> proc(ProcessState::self());
     sp<IServiceManager> sm = defaultServiceManager();
-- 
1.7.9.5

